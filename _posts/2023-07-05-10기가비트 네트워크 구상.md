---
title: 10Gbit 네트워크 구상
date: 2023-07-06 02:00:00 +0900
categories: [Development, Etc]
tags: [network, infrastructure]
---
이번에 해킨토시를 구축하면서, 문제 아닌 문제가 좀 생겼다. 바로 서버가 없어졌다는 것이다. 뭐 내 선택이니까 누굴 원망하고 그런것도 없다니와 그냥 그럴 뿐인 것이다.  
서버가 없어졌으니 내 NAS에 들어간 하드디스크를 지금 mac에 물려놓고 있는데, 가장 좋은 건 macOS도 BSD 기반이라 ZFS가 된다는 것이다. 적당히 급할 때 컴퓨터 켜서, 데이터 뺴오고, 컴퓨터 끄는 습관을 들이는 데 가장 좋다.  
다만 걱정되는 건 ZFS는 주기적으로 Scrub을 돌려 데이터 오류를 해결해 줘야 한다는 것이다. 이건 ZFS가 오류를 내서가 아니라, 용량이 많은 NAS를 운영하면 자연적으로 하드디스크에 Bit Flip과 같은 오류가 발생하게 되고, 이는 나중에 데이터 읽기 시에 치명적인 오류를 일으킬 수 있기 때문이다. 나는 RAID-Z2를 쓰니까 하드디스크 2개가 죽어도 데이터가 살아있지만, 아직 123 백업 규칙을 지킬 정도는 아니라 조금 걱정이 되긴 한다.
# 10기가비트 네트워크 구상
## 개요
10기가비트 네트워크를 구상하게 된 건 그냥 하나의 호기심이기도 하고, 서버를 다시 세팅한다는 가정 하에 하는 구상이다. 10기가비트. 누가 들어도 좋지 않나. 하하.  
일단 우리 집은 500Mbps 인터넷을 쓰고 있다. 1980년대에 지어진 아파트라, 내벽에 UTP도 겨우 설치했다는 이야기를 언젠가 들은 적이 있다. 그때는 전화선 밖에 없었다고... 그래서 UTP를 저층은 우수관을, 고층은 외벽을 따라 설치한다. (광케이블 들어오는 신축으로 이사가고싶다...)  
그리고 집 내부에 있는 케이블들도 Cat.5e라 RJ45를 쓰고 있다. 하나 예외가 있다면, 내 방과 거실을 잇는 케이블은 벽을 통과해서 쓰고 있어서, 잘하면 광케이블을 넣을 수도 있을 거 같다는 생각이 들었다는 거다.  
일단 그럼 생각해봐야 할 게 다음과 같다
1. WAN은 RJ45로 들어온다
2. 동생 방으로 이어지는 RJ45는 Cat.5e 선이라 1Gbps가 최대이다
3. 메인 WiFi 라우터는 RJ45를 사용하거나, 라우터에서 PCIe를 지원하면 OpenWRT를 설치하여 사용한다
4. 내 방으로 이어지는 RJ45는 STP로 바꿀 수 있다.  
그럼 결국 내 방에만 10Gbps로 깔면 안되나 싶긴 하다. 근데 이것도 조금 조심스러운 부분이 있다.
## 현재 네트워크 구성
현재 네트워크 구성은 다음과 같다
- 10.0.0.0/24: 무선 네트워크 이용 대역
- 10.0.10.0/24: 서버 네트워크 (전에 실물 서버가 이 대역에 물려 있어서, 지금은 내 컴퓨터 대역이다)
- 10.0.20.0/24: 데스크톱 네트워크 (전에 내 방에 데스크톱이 있었을 때 이 대역을 사용했다)
- 10.0.30.0/24: 사용하지 않음
- 10.0.40.0/24: 서버 VM 대역
- 10.0.50.0/24: 데스크톱 VM 대역  
이렇게 구성해 놓고 있었다  
그래서 10.0.20.0 대역의 데스크톱이 10.0.40.0 대역의 VM에 접근하려면 라우터를 거쳐야 했기 때문에 라우터 또한 10Gbps를 버틸 수 있었어야 했다.  
근데 이제 그럴 필요가 없잖아...? 물리적 공간에 따라 VLAN을 다시 나누면 그럴 필요가 없다.
## VLAN 네트워크 구상
그럼 물리적 공간에 따라 네트워크를 나누면 다음과 같이 나눌 수 있다.
- 10.0.0.0/24: 무선 네트워크 이용 대역
- 10.0.10.0/24: 내 방 네트워크 대역  
끝이다.  
동생방도 조금 더 세분화 하고 싶지만, 다음과 같은 문제가 있다.
1. 동생은 유선으로 기기를 연결하지 않는다
2. 동생 방에 있는 공유기가 VLAN을 지원하지 않는 Unmanaged 기기이다  
그래서 내 방이랑 무선네트워크 대역만 나누어주면 되는 것이였다.
## 물리 네트워크 구상
그럼 라우터는 그대로 놓고, 내 방에 들어오는 라우터만 10Gbps로 바꾸어 주면 된다. 거실에서 들어오는 네트워크를 WAN이라고 생각하고 놓으면 되는 것이다. (정확히는 Trunk 포트가 맞긴 하겠다)
10Gbps를 지원하는 가장 저렴한 기기는 [Mikrotik사의 CSS610-8G-2S+IN 스위치허브](https://prod.danawa.com/info/?pcode=14382134&cate=11230207)이다. 이전 회사에서는 이것보다 조금 더 큰 장비를 썼었다.
나중을 생각해서 조금 확장성 있는 장비를 구매하자면 Mikrotik사의 [CRS305-1G-4S+IN 스위치허브](https://prod.danawa.com/info/?pcode=14664734&cate=11230207)가 있다. 차이는 이름에서 알 수 있듯이 CSS610-8G-2S+IN은 1Gbps RJ45가 8개, 10Gbps SFP가 2개라는 것이고 CRS305-1G-4S+IN의 경우 1Gbps RJ45가 1개, 10Gbps SFP가 4개라는 것이다.
근데 두 기기의 가격이 10만원 정도 차이가 나고, 나중에 추가적인 기기들은 SFP보다는 RJ45를 쓸 가능성이 더 많다는 걸 기억한다면 전자가 더 나은 것 같다.
